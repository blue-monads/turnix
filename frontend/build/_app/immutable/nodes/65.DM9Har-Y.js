import{b as S,a as b,t as Q,c as Pa}from"../chunks/disclose-version.wcsHG7oF.js";import{p as da,s as e,c as a,f as ft,b as s,h as D,t as m,a as ia,i as C,e as ra,r as t,g as za,d as oa}from"../chunks/runtime.D6lgFUio.js";import{i as P}from"../chunks/if.lkQ-IRrr.js";import{p as z}from"../chunks/proxy.r5-P5EHK.js";import{s as qa,a as Aa}from"../chunks/store.BaapSzAp.js";import{N as Oa}from"../chunks/index.Duto3aX0.js";import{p as Ca}from"../chunks/stores.D4Dcgzbh.js";import"../chunks/auto_form.CxbPX2mo.js";import"../chunks/autotable.D6q4cofd.js";import"../chunks/index.BXdKDRLQ.js";import{L as Ra}from"../chunks/loader.BeY12cOT.js";import{s as l}from"../chunks/render.CIW-w3Th.js";import{e as Ba,i as La}from"../chunks/each.CWrzZiCN.js";import{r as sa}from"../chunks/attributes.BFGPVQjG.js";import{d as Ma}from"../chunks/utils.Dh-XvBAd.js";import{r as Xa}from"../chunks/misc.CFrgioPu.js";import{b as gt}from"../chunks/input.DAoTAKLA.js";import{p as u}from"../chunks/props.C7PlKWmz.js";import{r as Ga}from"../chunks/legacy-client.B7AzNrU7.js";import{S as la}from"../chunks/SvgIcon.Cj01WnO8.js";import{g as Qa}from"../chunks/stores.CebXFGJ4.js";import"../chunks/ProgressBar.svelte_svelte_type_style_lang.DbB_HC5r.js";import{R as Ua,a as na}from"../chunks/RadioItem.B7kmI_5f.js";import{g as Ea}from"../chunks/entry.Y6HcnCx3.js";import{f as T}from"../chunks/index.UdVxqQke.js";/* empty css                                                     */const Fa=(I,o,d,n,_)=>{o.trigger({type:"component",component:"books_client_picker",meta:{api:d.api,pid:d.pid,onSelect:x=>{n()||n(x.name||""),_(x.id||0)}}})},Ha=(I,o,d,n)=>{o.trigger({type:"component",component:"books_sales_item_pick",meta:{api:d.api,pid:d.pid,onSave:_=>{n().push(_),n(n())}}})},Ja=(I,o,d,n)=>{o.trigger({type:"component",component:"books_sales_overall_tax_picker",meta:{sub_total:d(),overall_tax_amount:n(),onSet:_=>{n(_)}}})},Ka=(I,o,d,n)=>{o.trigger({type:"component",component:"books_sales_overall_discount_picker",meta:{sub_total:d(),overall_discount_amount:n(),onSet:_=>{n(_)}}})};var Va=Q("<!> <!>",1),Wa=Q("<span> </span> = <strong> </strong>",1),Ya=Q('<tr><td class="px-4 py-2 border"> </td><td class="px-4 py-2 text-right border tabular-nums slashed-zero"> </td><td class="px-4 py-2 text-right border tabular-nums slashed-zero"><!></td><td class="px-4 py-2 text-right border tabular-nums slashed-zero"><!></td><td class="px-4 py-2 text-right border tabular-nums slashed-zero">( <span> <!> <!></span> <strong> </strong></td><td class="px-4 py-2 text-right border tabular-nums slashed-zero"><button class="hover:underline text-warning-800 text-xs">remove</button></td></tr>'),Za=async(I,o,d,n,_,x,q,N,A,j,g,h,k,i,f,p)=>{const R=await o.submit({sale:{title:d(),notes:n(),client_id:_(),client_name:x(),total_item_price:q(),total_item_tax_amount:N(),total_item_discount_amount:A(),sub_total:j(),overall_discount_amount:g(),overall_tax_amount:h(),total:k(),sales_date:i()},lines:f()});D(p,z(R))},$a=Q('<form class="p-2"><div class="card"><header class="card-header flex justify-between"><h3 class="h3">New Sale</h3> <div class="w-64"><!></div></header> <section class="p-4 flex flex-col gap-4"><div class="flex gap-2 justify-between"><div class="flex flex-col gap-2"><label class="label"><span>Title</span> <div class="flex gap-2"><input type="text" class="input p-1" placeholder="title"></div></label> <label class="label"><span>Billed To</span> <div class="flex gap-2"><span class="text-sm italic"> </span> <button><!></button></div></label></div> <label class="label"><span>Date of Sale</span> <input type="datetime-local" class="input p-1" placeholder="Date"></label></div> <div class="max-h-96 overflow-auto"><table class="w-full text-left table-auto print:text-sm" id="table-items"><thead><tr class="variant-filled print:bg-gray-300 print:text-black"><th class="px-4 py-2">Item</th><th class="px-4 py-2 text-right">Qty</th><th class="px-4 py-2 text-right">Unit Price</th><th class="px-4 py-2 text-right">Tax</th><th class="px-4 py-2 text-right">Subtotal</th><th class="px-4 py-2 text-right"></th></tr></thead><tbody></tbody></table></div> <div class="flex justify-start p-2"><button class="btn btn-sm variant-filled"><!></button></div> <div class="flex gap-2 w-full justify-between"><label class="label flex flex-col gap-2 w-full md:w-1/2"><span>Notes</span> <textarea class="textarea p-1" rows="4" placeholder="Notes about the sale.."></textarea></label> <div class="flex flex-col gap-2 text-sm"><table><tbody><tr><td class="px-2 py-2 border border-gray-400">Total Items TAX</td><td class="px-2 py-2 border border-gray-400 text-right"><span> </span></td></tr><tr><td class="px-2 py-2 border border-gray-400">Total Items Discount</td><td class="px-2 py-2 border border-gray-400 text-right"><span> </span></td></tr><tr><td class="px-2 py-2 border border-gray-400 border-b-gray-800">Sub Total</td><td class="px-2 py-2 border border-gray-400 border-b-gray-800 text-right"><strong> </strong></td></tr><tr><td class="px-2 py-2 border border-gray-800">Overall TAX</td><td class="px-2 py-2 border border-gray-800 text-right"><button class="underline"><span><strong> </strong> <!></span></button></td></tr><tr><td class="px-2 py-2 border border-gray-800">Overall Discount</td><td class="px-2 py-2 border border-gray-800 text-right"><button class="underline"><span><strong> </strong> <!></span></button></td></tr><tr><td class="px-2 py-2 border border-gray-800 font-semibold">Total</td><td class="px-2 py-2 border border-gray-800 text-right font-semibold"> </td></tr></tbody></table></div></div> <div><p class="text-red-500"> </p></div></section> <footer class="card-footer flex justify-end"><button class="btn variant-filled">save</button></footer></div></form>');function te(I,o){da(o,!0);const d=Qa();let n=u(o,"title",15,""),_=u(o,"notes",15,""),x=u(o,"client_id",15,0),q=u(o,"client_name",3,""),N=u(o,"total_item_price",15,0),A=u(o,"total_item_tax_amount",15,0),j=u(o,"total_item_discount_amount",15,0),g=u(o,"sub_total",15,0),h=u(o,"overall_discount_amount",15,0),k=u(o,"overall_tax_amount",15,0),i=u(o,"total",15,0),f=u(o,"sales_date",31,()=>z(new Date().toISOString().slice(0,16))),p=u(o,"lines",31,()=>z([])),R=u(o,"contactsNameIndex",19,()=>({})),X=C("invoice"),yt=C(""),U=C(0),E=C(0);Ga(()=>{N(p().reduce((v,r)=>v+r.amount*r.qty,0)),A(p().reduce((v,r)=>v+r.tax_amount*r.qty,0)),j(p().reduce((v,r)=>v+r.discount_amount*r.qty,0)),g(p().reduce((v,r)=>v+r.total_amount,0)),D(U,k()/g()*100),D(E,h()/g()*100),i(g()+k()-h())});var F=$a(),ht=a(F),H=a(ht),kt=e(a(H),2),_a=a(kt);Ua(_a,{children:(v,r)=>{var G=Va(),O=ft(G);na(O,{get group(){return s(X)},set group(w){D(X,z(w))},name:"justify",value:"direct_sale",children:(w,L)=>{ra();var M=S("Direct Sale");b(w,M)},$$slots:{default:!0}});var B=e(O,2);na(B,{get group(){return s(X)},set group(w){D(X,z(w))},name:"justify",value:"invoice",children:(w,L)=>{ra();var M=S("Invoice");b(w,M)},$$slots:{default:!0}}),b(v,G)},$$slots:{default:!0}}),t(kt),t(H);var J=e(H,2),K=a(J),V=a(K),W=a(V),wt=e(a(W),2),St=a(wt);sa(St),t(wt),t(W);var It=e(W,2),Nt=e(a(It),2),Y=a(Nt),ca=a(Y);t(Y);var Z=e(Y,2);Z.__click=[Fa,d,o,n,x];var pa=a(Z);la(pa,{name:"plus",className:"w-4 h-4 inline-block align-middle"}),t(Z),t(Nt),t(It),t(V);var Tt=e(V,2),Dt=e(a(Tt),2);sa(Dt),t(Tt),t(K);var $=e(K,2),jt=a($),Pt=e(a(jt));Ba(Pt,21,p,La,(v,r,G)=>{var O=Ya(),B=a(O),w=a(B);t(B);var L=e(B),M=a(L);t(L);var vt=e(L),wa=a(vt);P(wa,()=>s(r).amount===s(r).price,y=>{var c=S();m(()=>l(c,s(r).amount)),b(y,c)},y=>{var c=Wa(),xt=ft(c),Da=a(xt);t(xt);var ea=e(xt,2),ja=a(ea);t(ea),m(()=>{l(Da,`${s(r).price??""} - (${s(r).discount_amount??""})`),l(ja,s(r).amount)}),b(y,c)}),t(vt);var mt=e(vt),Sa=a(mt);P(Sa,()=>s(r).tax_amount,y=>{var c=S();m(()=>l(c,s(r).tax_amount)),b(y,c)},y=>{var c=S("-");b(y,c)}),t(mt);var ut=e(mt),bt=e(a(ut)),Yt=a(bt),Zt=e(Yt);P(Zt,()=>s(r).discount_amount,y=>{var c=S();m(()=>l(c,`- ${s(r).discount_amount??""}`)),b(y,c)});var Ia=e(Zt,2);P(Ia,()=>s(r).tax_amount,y=>{var c=S();m(()=>l(c,`+ ${s(r).tax_amount??""}`)),b(y,c)}),t(bt);var $t=e(bt),ta=e($t),Na=a(ta);t(ta),t(ut);var aa=e(ut),Ta=a(aa);Ta.__click=()=>{p().splice(G,1),p(p())},t(aa),t(O),m(()=>{l(w,s(r).info),l(M,s(r).qty),l(Yt,`${s(r).price??""} `),l($t,` ) * ${s(r).qty??""} = `),l(Na,s(r).total_amount)}),b(v,O)}),t(Pt),t(jt),t($);var tt=e($,2),at=a(tt);at.__click=[Ha,d,o,p];var va=a(at);la(va,{name:"plus",className:"w-4 h-4 inline-block align-middle"}),t(at),t(tt);var et=e(tt,2),rt=a(et),zt=e(a(rt),2);Xa(zt),t(rt);var qt=e(rt,2),At=a(qt),Ot=a(At),ot=a(Ot),Ct=e(a(ot)),Rt=a(Ct),ma=a(Rt);m(()=>l(ma,T(A()))),t(Rt),t(Ct),t(ot);var st=e(ot),Bt=e(a(st)),Lt=a(Bt),ua=a(Lt);m(()=>l(ua,T(j()))),t(Lt),t(Bt),t(st);var lt=e(st),Mt=e(a(lt)),Xt=a(Mt),ba=a(Xt);m(()=>l(ba,T(g()))),t(Xt),t(Mt),t(lt);var nt=e(lt),Gt=e(a(nt)),dt=a(Gt);dt.__click=[Ja,d,g,k];var Qt=a(dt),it=a(Qt),xa=a(it);m(()=>l(xa,T(k()))),t(it);var ga=e(it,2);P(ga,()=>s(U),v=>{var r=S();m(()=>l(r,`[${T(s(U))??""}%]`)),b(v,r)}),t(Qt),t(dt),t(Gt),t(nt);var _t=e(nt),Ut=e(a(_t)),ct=a(Ut);ct.__click=[Ka,d,g,h];var Et=a(ct),pt=a(Et),fa=a(pt);m(()=>l(fa,T(h()))),t(pt);var ya=e(pt,2);P(ya,()=>s(E),v=>{var r=S();m(()=>l(r,`[${T(s(E))??""}%]`)),b(v,r)}),t(Et),t(ct),t(Ut),t(_t);var Ft=e(_t),Ht=e(a(Ft)),ha=a(Ht);m(()=>l(ha,T(i()))),t(Ht),t(Ft),t(Ot),t(At),t(qt),t(et);var Jt=e(et,2),Kt=a(Jt),ka=a(Kt);t(Kt),t(Jt),t(J);var Vt=e(J,2),Wt=a(Vt);Wt.__click=[Za,o,n,_,x,q,N,A,j,g,h,k,i,f,p,yt],t(Vt),t(ht),t(F),m(()=>{l(ca,R()[x()]||""),l(ka,s(yt)),Wt.disabled=p().length===0||!x()}),gt(St,n),gt(Dt,f),gt(zt,_),b(I,F),ia()}Ma(["click"]);function Te(I,o){da(o,!0);const d=qa(),_=Aa(Ca,"$page",d).params.pid,x=Oa(za("__api__"));let q=C(z([])),N=C(!0);(async()=>{D(N,!0);const i=await x.listContacts(_);i.status===200&&(D(q,z(i.data)),D(N,!1))})();let j=oa(()=>s(q).reduce((i,f)=>{const p=f.id,R=f.name;return i[p]=R,i},{}));const g=async i=>{console.log("@submit/data",i);const f=await x.addSale(_,i);return f.status!==200?f.data.message:(Ea(`/z/pages/portal/projects/books/${_}/sales`),"")};var h=Pa(),k=ft(h);P(k,()=>s(N),i=>{Ra(i,{})},i=>{var f=oa(()=>Number(_));te(i,{get pid(){return s(f)},api:x,get contactsNameIndex(){return s(j)},submit:g})}),b(I,h),ia()}export{Te as component};
