import{c as Ee,a as c,b as ce,t as h}from"./disclose-version.wcsHG7oF.js";import{p as Ne,i as A,g as Oe,f as He,a as De,h as m,s as t,c as o,b as l,t as ve,r as a,e as Je,d as E}from"./runtime.D6lgFUio.js";import{s as Ue}from"./render.CIW-w3Th.js";import{i as f}from"./if.lkQ-IRrr.js";import{e as Fe,i as Ie}from"./each.CWrzZiCN.js";import{r as N,a as Ve}from"./attributes.BFGPVQjG.js";import{d as Le}from"./utils.Dh-XvBAd.js";import{b as B}from"./input.DAoTAKLA.js";import{b as G}from"./select.BfGKzECA.js";import{p}from"./props.C7PlKWmz.js";import{s as ze,a as Me}from"./store.BaapSzAp.js";import{p as K}from"./proxy.r5-P5EHK.js";import{_ as _e}from"./_kv_editor.SKGkUTMX.js";import{L as Pe}from"./loader.BeY12cOT.js";import{p as Re}from"./index.BTu0Thf0.js";import{C as We,a as Xe,j as qe,l as Ae,s as Be}from"./index.1_1nzF9G.js";const Ge=`


/**
 * @typedef {Object} Context
 * @property {number} event_id - The ID of the event.
 * @property {string} event_type - The type of the event.
 * @property {string} hook_type - The type of the hook.
 * @property {number} session_user - The ID of the session user.
 * @property {number} runas_user - The ID of the user running as another user.
 * @property {function(): Object.<string, any>} getData - Function to get data.
 * @property {function(): [string, string]} getUserToken - Function to get the user token.
 * 
 * Handles the given context.
 *
 * @param {Context} ctx - The context object.
 */
const handle = (ctx) => {
  
};

`,Ke={ctx:{event_id:0,event_type:"",hook_type:"",session_user:0,runas_user:0,getUserToken:()=>["",""],getData:()=>{}},fetchSync:null};var Qe=h("<option> </option>"),Ye=h('<div class="flex gap-2 items-center"><input class="input p-1 w-44" type="text" disabled placeholder="John"> <div class="pt-4 inline-flex justify-self-center"><button class="variant-filled btn btn-sm">pick</button></div></div>'),Ze=h('<label class="label"><span>Script Code</span> <div class="p-1 rounded border bg-white max-h-screen"><!></div></label>'),$e=h('<label class="label"><span>Endpoint</span> <input class="input p-0.5" type="url" placeholder="http://example.com/receive"></label>'),et=h('<label class="label"><span>Handler</span> <input class="input p-0.5" type="url" placeholder="handleXyz"></label>'),tt=async(Q,r,y,b,k,g,_,v,x,u,d,C,S)=>{m(r,!0),l(y)==="context_user"?b(0):l(y)==="no_user"&&b(-1),await k()({id:g(),name:_(),hook_code:v(),runas_user_id:b(),hook_type:x(),envs:u(),extrameta:d(),target:C(),event:S()}),m(r,!1)},at=h('<div class="flex p-2 flex-col gap-2"><div class="card p-4 flex flex-col gap-2"><header class="card-header"><h4 class="h4"><!></h4></header> <section class="p-4 flex flex-col gap-4"><label class="label"><span>Name</span> <input class="input p-0.5" type="text" placeholder="name"></label> <label class="label"><span>Event Type</span> <select class="select"></select></label> <label class="flex items-center space-x-2"><p>Run as</p> <select class="select w-44"><option>Specific User</option><option>Context User</option><option>No User</option></select></label> <!> <label class="label"><span>Hook Type</span> <select class="select"><option>Script</option><option>Native Function</option><option>Webhook</option></select></label> <!> <!> <!> <div class="label"><span>Extrameta</span> <!></div> <div class="label"><span>Env Vars</span> <!></div></section> <footer class="card-footer flex justify-end"><button class="btn btn-sm variant-filled">save</button></footer></div></div>');function xt(Q,r){Ne(r,!0);const y=ze(),b=()=>Me(Re,"$params",y);let k=p(r,"id",3,0),g=p(r,"hook_code",31,()=>K(Ge)),_=p(r,"runas_user_id",31,()=>-1),v=p(r,"hook_type",15,"webhook"),x=p(r,"target",15,""),u=p(r,"envs",15,"{}"),d=p(r,"extrameta",15,"{}"),C=p(r,"event",15,""),S=p(r,"name",15,""),ue=p(r,"onSave",3,async i=>{}),T=A(K(_()===-1?"no_user":_()===0?"context_user":"specific_user"));const de=b().ptype,fe=Oe("__api__");let Y=A(void 0),w=A(!0),me={};(async()=>{m(w,!0);const i=await fe.getProjectType(de);i.status===200&&(m(Y,K(i.data)),m(w,!1))})();const he=i=>{console.log("handleExtrametaChange",i),d(JSON.stringify(i))},be=i=>{console.log("handleEnvVarChange",i),u(JSON.stringify(i))};var Z=Ee(),ge=He(Z);f(ge,()=>l(w),i=>{Pe(i,{})},i=>{var O=at(),$=o(O),H=o($),ee=o(H),xe=o(ee);f(xe,()=>k()===0,n=>{var e=ce("New Hook");c(n,e)},n=>{var e=ce("Edit Hook");c(n,e)}),a(ee),a(H);var D=t(H,2),J=o(D),te=t(o(J),2);N(te),a(J);var U=t(J,2),F=t(o(U),2);Fe(F,21,()=>l(Y).event_types||[],Ie,(n,e)=>{var s=Qe(),j={},q=o(s);a(s),ve(()=>{j!==(j=l(e))&&(s.value=(s.__value=l(e))==null?"":l(e)),Ue(q,l(e))}),c(n,s)}),a(F),a(U);var I=t(U,2),V=t(o(I),2),L=o(V);L.value=(L.__value="specific_user")==null?"":"specific_user";var z=t(L);z.value=(z.__value="context_user")==null?"":"context_user";var ae=t(z);ae.value=(ae.__value="no_user")==null?"":"no_user",a(V),a(I);var oe=t(I,2);f(oe,()=>l(T)==="specific_user",n=>{var e=Ye(),s=o(e);N(s),Je(2),a(e),ve(()=>Ve(s,me[_()]||"")),c(n,e)});var M=t(oe,2),P=t(o(M),2),R=o(P);R.value=(R.__value="script")==null?"":"script";var W=t(R);W.value=(W.__value="native_function")==null?"":"native_function";var se=t(W);se.value=(se.__value="webhook")==null?"":"webhook",a(P),a(M);var ne=t(M,2);f(ne,()=>v()==="script",n=>{var e=Ze(),s=t(o(e),2),j=o(s),q=E(()=>[Xe({activateOnTyping:!0,override:[Ae,Be(Ke)]})]),we=E(qe);We(j,{get extensions(){return l(q)},get value(){return g()},set value(je){g(je)},get lang(){return l(we)}}),a(s),a(e),c(n,e)});var re=t(ne,2);f(re,()=>v()==="webhook",n=>{var e=$e(),s=t(o(e),2);N(s),a(e),B(s,x),c(n,e)});var le=t(re,2);f(le,()=>v()==="native_function",n=>{var e=et(),s=t(o(e),2);N(s),a(e),B(s,x),c(n,e)});var X=t(le,2),ye=t(o(X),2),ke=E(()=>d()?JSON.parse(d()):{});_e(ye,{get data(){return l(ke)},onChange:he}),a(X);var ie=t(X,2),Ce=t(o(ie),2),Se=E(()=>u()?JSON.parse(u()):{});_e(Ce,{sensitive:!0,get data(){return l(Se)},onChange:be}),a(ie),a(D);var pe=t(D,2),Te=o(pe);Te.__click=[tt,w,T,_,ue,k,S,g,v,u,d,x,C],a(pe),a($),a(O),B(te,S),G(F,C),G(V,()=>l(T),n=>m(T,n)),G(P,v),c(i,O)}),c(Q,Z),De()}Le(["click"]);export{xt as H};
