import{s as mt,A as ot,i as X,f as m,k as bt,z as gt,C as Re,e as u,a as g,c,b as k,g as C,q as S,m as p,D as Ke,x as j,h as o,E as ce,r as ae,v as Ct,y as kt,n as Et,t as Qe,d as We,j as yt,Q as xt,S as Nt}from"./scheduler.CW5wdEZY.js";import{S as Tt,i as St,g as pt,a as le,d as vt,t as W,c as we,b as De,m as He,e as je,f as Ot}from"./index.CHcwNeV9.js";import{e as rt}from"./each.D6YF6ztN.js";import{K as it}from"./_kv_editor.Bb83Zj4n.js";import{L as It}from"./loader.IUjCcxZ8.js";import{p as Lt}from"./index.CiLJ2KWW.js";import{a as Pt,j as At,C as wt,l as Dt,s as Ht}from"./index.C2vjKDY2.js";const jt=`


/**
 * @typedef {Object} Context
 * @property {number} event_id - The ID of the event.
 * @property {string} event_type - The type of the event.
 * @property {string} hook_type - The type of the hook.
 * @property {number} session_user - The ID of the session user.
 * @property {number} runas_user - The ID of the user running as another user.
 * @property {function(): Object.<string, any>} getData - Function to get data.
 * @property {function(): [string, string]} getUserToken - Function to get the user token.
 * 
 * Handles the given context.
 *
 * @param {Context} ctx - The context object.
 */
const handle = (ctx) => {
  
};

`,Ut={ctx:{event_id:0,event_type:"",hook_type:"",session_user:0,runas_user:0,getUserToken:()=>["",""],getData:()=>{}},fetchSync:null};function ut(a,t,e){const r=a.slice();return r[28]=t[e],r}function Vt(a){let t,e,r,f,s,l,h,n,d="Name",P,v,N,E,z,pe="Event Type",fe,A,q,F,ne,ve="Run as",_e,D,V,me="Specific User",B,be="Context User",J,ge="No User",he,_,G,se,Xe="Hook Type",Ue,U,M,Ge="Script",R,Ye="Native Function",K,Ze="Webhook",Ve,Ce,ke,Ee,Y,oe,$e="Extrameta",Be,Z,Je,$,re,et="Env Vars",ze,ee,Fe,ie,te,tt="save",ye,qe,lt;function nt(i,x){return i[8]===0?zt:Jt}let xe=nt(a),Q=xe(a),ue=rt(a[11].event_types||[]),T=[];for(let i=0;i<ue.length;i+=1)T[i]=ct(ut(a,ue,i));let O=a[10]==="specific_user"&&ft(a),y=a[2]==="script"&&_t(a),I=a[2]==="webhook"&&ht(a),L=a[2]==="native_function"&&dt(a);return Z=new it({props:{data:a[5]?JSON.parse(a[5]):{},onChange:a[14]}}),ee=new it({props:{sensitive:!0,data:a[4]?JSON.parse(a[4]):{},onChange:a[15]}}),{c(){t=u("div"),e=u("div"),r=u("header"),f=u("h4"),Q.c(),s=g(),l=u("section"),h=u("label"),n=u("span"),n.textContent=d,P=g(),v=u("input"),N=g(),E=u("label"),z=u("span"),z.textContent=pe,fe=g(),A=u("select");for(let i=0;i<T.length;i+=1)T[i].c();q=g(),F=u("label"),ne=u("p"),ne.textContent=ve,_e=g(),D=u("select"),V=u("option"),V.textContent=me,B=u("option"),B.textContent=be,J=u("option"),J.textContent=ge,he=g(),O&&O.c(),_=g(),G=u("label"),se=u("span"),se.textContent=Xe,Ue=g(),U=u("select"),M=u("option"),M.textContent=Ge,R=u("option"),R.textContent=Ye,K=u("option"),K.textContent=Ze,Ve=g(),y&&y.c(),Ce=g(),I&&I.c(),ke=g(),L&&L.c(),Ee=g(),Y=u("div"),oe=u("span"),oe.textContent=$e,Be=g(),we(Z.$$.fragment),Je=g(),$=u("div"),re=u("span"),re.textContent=et,ze=g(),we(ee.$$.fragment),Fe=g(),ie=u("footer"),te=u("button"),te.textContent=tt,this.h()},l(i){t=c(i,"DIV",{class:!0});var x=k(t);e=c(x,"DIV",{class:!0});var H=k(e);r=c(H,"HEADER",{class:!0});var de=k(r);f=c(de,"H4",{class:!0});var w=k(f);Q.l(w),w.forEach(m),de.forEach(m),s=C(H),l=c(H,"SECTION",{class:!0});var b=k(l);h=c(b,"LABEL",{class:!0});var Ne=k(h);n=c(Ne,"SPAN",{"data-svelte-h":!0}),S(n)!=="svelte-15ueaex"&&(n.textContent=d),P=C(Ne),v=c(Ne,"INPUT",{class:!0,type:!0,placeholder:!0}),Ne.forEach(m),N=C(b),E=c(b,"LABEL",{class:!0});var Te=k(E);z=c(Te,"SPAN",{"data-svelte-h":!0}),S(z)!=="svelte-9ln18y"&&(z.textContent=pe),fe=C(Te),A=c(Te,"SELECT",{class:!0});var at=k(A);for(let Me=0;Me<T.length;Me+=1)T[Me].l(at);at.forEach(m),Te.forEach(m),q=C(b),F=c(b,"LABEL",{class:!0});var Se=k(F);ne=c(Se,"P",{"data-svelte-h":!0}),S(ne)!=="svelte-3r72ax"&&(ne.textContent=ve),_e=C(Se),D=c(Se,"SELECT",{class:!0});var Oe=k(D);V=c(Oe,"OPTION",{"data-svelte-h":!0}),S(V)!=="svelte-nd2rx5"&&(V.textContent=me),B=c(Oe,"OPTION",{"data-svelte-h":!0}),S(B)!=="svelte-1v0wrfd"&&(B.textContent=be),J=c(Oe,"OPTION",{"data-svelte-h":!0}),S(J)!=="svelte-9j2l23"&&(J.textContent=ge),Oe.forEach(m),Se.forEach(m),he=C(b),O&&O.l(b),_=C(b),G=c(b,"LABEL",{class:!0});var Ie=k(G);se=c(Ie,"SPAN",{"data-svelte-h":!0}),S(se)!=="svelte-17xb6at"&&(se.textContent=Xe),Ue=C(Ie),U=c(Ie,"SELECT",{class:!0});var Le=k(U);M=c(Le,"OPTION",{"data-svelte-h":!0}),S(M)!=="svelte-nu0r1i"&&(M.textContent=Ge),R=c(Le,"OPTION",{"data-svelte-h":!0}),S(R)!=="svelte-31mfp5"&&(R.textContent=Ye),K=c(Le,"OPTION",{"data-svelte-h":!0}),S(K)!=="svelte-6kp5qs"&&(K.textContent=Ze),Le.forEach(m),Ie.forEach(m),Ve=C(b),y&&y.l(b),Ce=C(b),I&&I.l(b),ke=C(b),L&&L.l(b),Ee=C(b),Y=c(b,"DIV",{class:!0});var Pe=k(Y);oe=c(Pe,"SPAN",{"data-svelte-h":!0}),S(oe)!=="svelte-cdbbnz"&&(oe.textContent=$e),Be=C(Pe),De(Z.$$.fragment,Pe),Pe.forEach(m),Je=C(b),$=c(b,"DIV",{class:!0});var Ae=k($);re=c(Ae,"SPAN",{"data-svelte-h":!0}),S(re)!=="svelte-qnd91x"&&(re.textContent=et),ze=C(Ae),De(ee.$$.fragment,Ae),Ae.forEach(m),b.forEach(m),Fe=C(H),ie=c(H,"FOOTER",{class:!0});var st=k(ie);te=c(st,"BUTTON",{class:!0,"data-svelte-h":!0}),S(te)!=="svelte-8pci6k"&&(te.textContent=tt),st.forEach(m),H.forEach(m),x.forEach(m),this.h()},h(){p(f,"class","h4"),p(r,"class","card-header"),p(v,"class","input p-0.5"),p(v,"type","text"),p(v,"placeholder","name"),p(h,"class","label"),p(A,"class","select"),a[6]===void 0&&Ke(()=>a[17].call(A)),p(E,"class","label"),V.__value="specific_user",j(V,V.__value),B.__value="context_user",j(B,B.__value),J.__value="no_user",j(J,J.__value),p(D,"class","select w-44"),a[10]===void 0&&Ke(()=>a[18].call(D)),p(F,"class","flex items-center space-x-2"),M.__value="script",j(M,M.__value),R.__value="native_function",j(R,R.__value),K.__value="webhook",j(K,K.__value),p(U,"class","select"),a[2]===void 0&&Ke(()=>a[19].call(U)),p(G,"class","label"),p(Y,"class","label"),p($,"class","label"),p(l,"class","p-4 flex flex-col gap-4"),p(te,"class","btn btn-sm variant-filled"),p(ie,"class","card-footer flex justify-end"),p(e,"class","card p-4 flex flex-col gap-2"),p(t,"class","flex p-2 flex-col gap-2")},m(i,x){X(i,t,x),o(t,e),o(e,r),o(r,f),Q.m(f,null),o(e,s),o(e,l),o(l,h),o(h,n),o(h,P),o(h,v),j(v,a[7]),o(l,N),o(l,E),o(E,z),o(E,fe),o(E,A);for(let H=0;H<T.length;H+=1)T[H]&&T[H].m(A,null);ce(A,a[6],!0),o(l,q),o(l,F),o(F,ne),o(F,_e),o(F,D),o(D,V),o(D,B),o(D,J),ce(D,a[10],!0),o(l,he),O&&O.m(l,null),o(l,_),o(l,G),o(G,se),o(G,Ue),o(G,U),o(U,M),o(U,R),o(U,K),ce(U,a[2],!0),o(l,Ve),y&&y.m(l,null),o(l,Ce),I&&I.m(l,null),o(l,ke),L&&L.m(l,null),o(l,Ee),o(l,Y),o(Y,oe),o(Y,Be),He(Z,Y,null),o(l,Je),o(l,$),o($,re),o($,ze),He(ee,$,null),o(e,Fe),o(e,ie),o(ie,te),ye=!0,qe||(lt=[ae(v,"input",a[16]),ae(A,"change",a[17]),ae(D,"change",a[18]),ae(U,"change",a[19]),ae(te,"click",a[23])],qe=!0)},p(i,x){if(xe!==(xe=nt(i))&&(Q.d(1),Q=xe(i),Q&&(Q.c(),Q.m(f,null))),x&128&&v.value!==i[7]&&j(v,i[7]),x&2048){ue=rt(i[11].event_types||[]);let w;for(w=0;w<ue.length;w+=1){const b=ut(i,ue,w);T[w]?T[w].p(b,x):(T[w]=ct(b),T[w].c(),T[w].m(A,null))}for(;w<T.length;w+=1)T[w].d(1);T.length=ue.length}x&2112&&ce(A,i[6]),x&1024&&ce(D,i[10]),i[10]==="specific_user"?O?O.p(i,x):(O=ft(i),O.c(),O.m(l,_)):O&&(O.d(1),O=null),x&4&&ce(U,i[2]),i[2]==="script"?y?(y.p(i,x),x&4&&W(y,1)):(y=_t(i),y.c(),W(y,1),y.m(l,Ce)):y&&(pt(),le(y,1,1,()=>{y=null}),vt()),i[2]==="webhook"?I?I.p(i,x):(I=ht(i),I.c(),I.m(l,ke)):I&&(I.d(1),I=null),i[2]==="native_function"?L?L.p(i,x):(L=dt(i),L.c(),L.m(l,Ee)):L&&(L.d(1),L=null);const H={};x&32&&(H.data=i[5]?JSON.parse(i[5]):{}),Z.$set(H);const de={};x&16&&(de.data=i[4]?JSON.parse(i[4]):{}),ee.$set(de)},i(i){ye||(W(y),W(Z.$$.fragment,i),W(ee.$$.fragment,i),ye=!0)},o(i){le(y),le(Z.$$.fragment,i),le(ee.$$.fragment,i),ye=!1},d(i){i&&m(t),Q.d(),Ct(T,i),O&&O.d(),y&&y.d(),I&&I.d(),L&&L.d(),je(Z),je(ee),qe=!1,kt(lt)}}}function Bt(a){let t,e;return t=new It({}),{c(){we(t.$$.fragment)},l(r){De(t.$$.fragment,r)},m(r,f){He(t,r,f),e=!0},p:Et,i(r){e||(W(t.$$.fragment,r),e=!0)},o(r){le(t.$$.fragment,r),e=!1},d(r){je(t,r)}}}function Jt(a){let t;return{c(){t=Qe("Edit Hook")},l(e){t=We(e,"Edit Hook")},m(e,r){X(e,t,r)},d(e){e&&m(t)}}}function zt(a){let t;return{c(){t=Qe("New Hook")},l(e){t=We(e,"New Hook")},m(e,r){X(e,t,r)},d(e){e&&m(t)}}}function ct(a){let t,e=a[28]+"",r,f;return{c(){t=u("option"),r=Qe(e),this.h()},l(s){t=c(s,"OPTION",{});var l=k(t);r=We(l,e),l.forEach(m),this.h()},h(){t.__value=f=a[28],j(t,t.__value)},m(s,l){X(s,t,l),o(t,r)},p(s,l){l&2048&&e!==(e=s[28]+"")&&yt(r,e),l&2048&&f!==(f=s[28])&&(t.__value=f,j(t,t.__value))},d(s){s&&m(t)}}}function ft(a){let t,e,r,f,s,l='<button class="variant-filled btn btn-sm">pick</button>';return{c(){t=u("div"),e=u("input"),f=g(),s=u("div"),s.innerHTML=l,this.h()},l(h){t=c(h,"DIV",{class:!0});var n=k(t);e=c(n,"INPUT",{class:!0,type:!0,placeholder:!0}),f=C(n),s=c(n,"DIV",{class:!0,"data-svelte-h":!0}),S(s)!=="svelte-zk3ga2"&&(s.innerHTML=l),n.forEach(m),this.h()},h(){p(e,"class","input p-1 w-44"),e.value=r=a[13][a[1]]||"",p(e,"type","text"),e.disabled=!0,p(e,"placeholder","John"),p(s,"class","pt-4 inline-flex justify-self-center"),p(t,"class","flex gap-2 items-center")},m(h,n){X(h,t,n),o(t,e),o(t,f),o(t,s)},p(h,n){n&2&&r!==(r=h[13][h[1]]||"")&&e.value!==r&&(e.value=r)},d(h){h&&m(t)}}}function _t(a){let t,e,r="Script Code",f,s,l,h,n;function d(v){a[20](v)}let P={extensions:[Pt({activateOnTyping:!0,override:[Dt,Ht(Ut)]})],lang:At()};return a[0]!==void 0&&(P.value=a[0]),l=new wt({props:P}),xt.push(()=>Ot(l,"value",d)),{c(){t=u("label"),e=u("span"),e.textContent=r,f=g(),s=u("div"),we(l.$$.fragment),this.h()},l(v){t=c(v,"LABEL",{class:!0});var N=k(t);e=c(N,"SPAN",{"data-svelte-h":!0}),S(e)!=="svelte-16a81ly"&&(e.textContent=r),f=C(N),s=c(N,"DIV",{class:!0});var E=k(s);De(l.$$.fragment,E),E.forEach(m),N.forEach(m),this.h()},h(){p(s,"class","p-1 rounded border bg-white max-h-screen"),p(t,"class","label")},m(v,N){X(v,t,N),o(t,e),o(t,f),o(t,s),He(l,s,null),n=!0},p(v,N){const E={};!h&&N&1&&(h=!0,E.value=v[0],Nt(()=>h=!1)),l.$set(E)},i(v){n||(W(l.$$.fragment,v),n=!0)},o(v){le(l.$$.fragment,v),n=!1},d(v){v&&m(t),je(l)}}}function ht(a){let t,e,r="Endpoint",f,s,l,h;return{c(){t=u("label"),e=u("span"),e.textContent=r,f=g(),s=u("input"),this.h()},l(n){t=c(n,"LABEL",{class:!0});var d=k(t);e=c(d,"SPAN",{"data-svelte-h":!0}),S(e)!=="svelte-5ayklz"&&(e.textContent=r),f=C(d),s=c(d,"INPUT",{class:!0,type:!0,placeholder:!0}),d.forEach(m),this.h()},h(){p(s,"class","input p-0.5"),p(s,"type","url"),p(s,"placeholder","http://example.com/receive"),p(t,"class","label")},m(n,d){X(n,t,d),o(t,e),o(t,f),o(t,s),j(s,a[3]),l||(h=ae(s,"input",a[21]),l=!0)},p(n,d){d&8&&s.value!==n[3]&&j(s,n[3])},d(n){n&&m(t),l=!1,h()}}}function dt(a){let t,e,r="Handler",f,s,l,h;return{c(){t=u("label"),e=u("span"),e.textContent=r,f=g(),s=u("input"),this.h()},l(n){t=c(n,"LABEL",{class:!0});var d=k(t);e=c(d,"SPAN",{"data-svelte-h":!0}),S(e)!=="svelte-ai16a6"&&(e.textContent=r),f=C(d),s=c(d,"INPUT",{class:!0,type:!0,placeholder:!0}),d.forEach(m),this.h()},h(){p(s,"class","input p-0.5"),p(s,"type","url"),p(s,"placeholder","handleXyz"),p(t,"class","label")},m(n,d){X(n,t,d),o(t,e),o(t,f),o(t,s),j(s,a[3]),l||(h=ae(s,"input",a[22]),l=!0)},p(n,d){d&8&&s.value!==n[3]&&j(s,n[3])},d(n){n&&m(t),l=!1,h()}}}function Ft(a){let t,e,r,f;const s=[Bt,Vt],l=[];function h(n,d){return n[12]?0:1}return t=h(a),e=l[t]=s[t](a),{c(){e.c(),r=ot()},l(n){e.l(n),r=ot()},m(n,d){l[t].m(n,d),X(n,r,d),f=!0},p(n,[d]){let P=t;t=h(n),t===P?l[t].p(n,d):(pt(),le(l[P],1,1,()=>{l[P]=null}),vt(),e=l[t],e?e.p(n,d):(e=l[t]=s[t](n),e.c()),W(e,1),e.m(r.parentNode,r))},i(n){f||(W(e),f=!0)},o(n){le(e),f=!1},d(n){n&&m(r),l[t].d(n)}}}function qt(a,t,e){let r;bt(a,Lt,_=>e(24,r=_));let{id:f=0}=t,{hook_code:s=jt}=t,{runas_user_id:l=-1}=t,{hook_type:h="webhook"}=t,{target:n=""}=t,{envs:d="{}"}=t,{extrameta:P="{}"}=t,{event:v=""}=t,{name:N=""}=t,E=l===-1?"no_user":l===0?"context_user":"specific_user",{onSave:z=async _=>{}}=t;const pe=r.ptype,fe=gt("__api__");let A,q=!0,F={};(async()=>{e(12,q=!0);const _=await fe.getProjectType(pe);_.status===200&&(e(11,A=_.data),e(12,q=!1))})();const ve=_=>{console.log("handleExtrametaChange",_),e(5,P=JSON.stringify(_))},_e=_=>{console.log("handleEnvVarChange",_),e(4,d=JSON.stringify(_))};function D(){N=this.value,e(7,N)}function V(){v=Re(this),e(6,v),e(11,A)}function me(){E=Re(this),e(10,E)}function B(){h=Re(this),e(2,h)}function be(_){s=_,e(0,s)}function J(){n=this.value,e(3,n)}function ge(){n=this.value,e(3,n)}const he=async()=>{e(12,q=!0),E==="context_user"?e(1,l=0):E==="no_user"&&e(1,l=-1),await z({id:f,name:N,hook_code:s,runas_user_id:l,hook_type:h,envs:d,extrameta:P,target:n,event:v}),e(12,q=!1)};return a.$$set=_=>{"id"in _&&e(8,f=_.id),"hook_code"in _&&e(0,s=_.hook_code),"runas_user_id"in _&&e(1,l=_.runas_user_id),"hook_type"in _&&e(2,h=_.hook_type),"target"in _&&e(3,n=_.target),"envs"in _&&e(4,d=_.envs),"extrameta"in _&&e(5,P=_.extrameta),"event"in _&&e(6,v=_.event),"name"in _&&e(7,N=_.name),"onSave"in _&&e(9,z=_.onSave)},[s,l,h,n,d,P,v,N,f,z,E,A,q,F,ve,_e,D,V,me,B,be,J,ge,he]}class Yt extends Tt{constructor(t){super(),St(this,t,qt,Ft,mt,{id:8,hook_code:0,runas_user_id:1,hook_type:2,target:3,envs:4,extrameta:5,event:6,name:7,onSave:9})}}export{Yt as H};
