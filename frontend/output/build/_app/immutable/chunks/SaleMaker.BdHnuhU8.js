import{a as m,t as gt,c as qa,b as g}from"./disclose-version.BOfWGsg9.js";import{p as za,i as G,t as _,a as Pa,h as Q,c as a,r as t,s as e,b as s,f as la,e as Aa}from"./runtime.CmPLUjJJ.js";import{s as l}from"./render.CZQ66Y_F.js";import{i as w}from"./if.DoU_1wcm.js";import{e as na,i as da}from"./each.BJPUi07-.js";import{r as ia}from"./attributes.yGGqmlPO.js";import{d as Ra}from"./events.DnYA5zBv.js";import{r as Ma}from"./misc.CveY8KIp.js";import{b as xt}from"./input.BRsTNa69.js";import{p as M}from"./proxy.DKs42Gzo.js";import{p as c}from"./props.IjRlZquB.js";import{r as Xa}from"./legacy-client.BxBrBVYa.js";import{S as _a}from"./SvgIcon.Cn9REWmg.js";import{g as Ba}from"./stores.C0Vv8-i4.js";import"./ProgressBar.svelte_svelte_type_style_lang.Kk8Ai2k7.js";import{R as Ca,a as Ga}from"./RadioItem.CAG-9525.js";import"./entry.CyBKS7ox.js";import{f}from"./index.UdVxqQke.js";import"./index.DQ4XhlMg.js";import"./autotable.D5y0wA8l.js";/* empty css                                             */const Qa=(T,o,n,d,p)=>{o.trigger({type:"component",component:"books_client_picker",meta:{api:n.api,pid:n.pid,onSelect:y=>{d()||d(y.name||""),p(y.id||0)}}})},Ua=(T,o,n,d)=>{o.trigger({type:"component",component:"books_sales_item_pick",meta:{api:n.api,pid:n.pid,onSave:p=>{d().push(p),d(d())}}})},Ea=(T,o,n,d)=>{o.trigger({type:"component",component:"books_sales_overall_tax_picker",meta:{sub_total:n(),overall_tax_amount:d(),onSet:p=>{d(p)}}})},Fa=(T,o,n,d)=>{o.trigger({type:"component",component:"books_sales_overall_discount_picker",meta:{sub_total:n(),overall_discount_amount:d(),onSet:p=>{d(p)}}})};var Ha=gt("<span> </span> = <strong> </strong>",1),Ja=gt('<tr><td class="px-4 py-2 border"> </td><td class="px-4 py-2 text-right border tabular-nums slashed-zero"> </td><td class="px-4 py-2 text-right border tabular-nums slashed-zero"><!></td><td class="px-4 py-2 text-right border tabular-nums slashed-zero"><!></td><td class="px-4 py-2 text-right border tabular-nums slashed-zero">( <span> <!> <!></span> <strong> </strong></td><td class="px-4 py-2 text-right border tabular-nums slashed-zero"><button class="hover:underline text-warning-800 text-xs">remove</button></td></tr>'),Ka=async(T,o,n,d,p,y,I,U,X,j,q,x,h,k,z,B)=>{const D=await o.submit({sale:{title:n(),notes:d(),client_id:p(),client_name:y(),total_item_price:I(),total_item_tax_amount:U(),total_item_discount_amount:X(),sub_total:j(),overall_discount_amount:q(),overall_tax_amount:x(),total:h(),sales_date:k()},lines:z()});Q(B,M(D))},La=gt('<form class="p-2"><div class="card"><header class="card-header flex justify-between"><h3 class="h3"> </h3> <div class="w-64"><!></div></header> <section class="p-4 flex flex-col gap-4"><div class="flex gap-2 justify-between"><div class="flex flex-col gap-2"><label class="label"><span>Title</span> <div class="flex gap-2"><input type="text" class="input p-1" placeholder="title"></div></label> <label class="label"><span>Billed To</span> <div class="flex gap-2"><span class="text-sm italic"> </span> <button><!></button></div></label></div> <label class="label"><span>Date</span> <input type="datetime-local" class="input p-1" placeholder="Date"></label></div> <div class="max-h-96 overflow-auto"><table class="w-full text-left table-auto print:text-sm" id="table-items"><thead><tr class="variant-filled print:bg-gray-300 print:text-black"><th class="px-4 py-2">Item</th><th class="px-4 py-2 text-right">Qty</th><th class="px-4 py-2 text-right">Unit Price</th><th class="px-4 py-2 text-right">Tax</th><th class="px-4 py-2 text-right">Subtotal</th><th class="px-4 py-2 text-right"></th></tr></thead><tbody></tbody></table></div> <div class="flex justify-start p-2"><button class="btn btn-sm variant-filled"><!></button></div> <div class="flex gap-2 w-full justify-between"><label class="label flex flex-col gap-2 w-full md:w-1/2"><span>Notes</span> <textarea class="textarea p-1" rows="4" placeholder="Notes about the sale.."></textarea></label> <div class="flex flex-col gap-2 text-sm"><table><tbody><tr><td class="px-2 py-2 border border-gray-400">Total Items TAX</td><td class="px-2 py-2 border border-gray-400 text-right"><span> </span></td></tr><tr><td class="px-2 py-2 border border-gray-400">Total Items Discount</td><td class="px-2 py-2 border border-gray-400 text-right"><span> </span></td></tr><tr><td class="px-2 py-2 border border-gray-400 border-b-gray-800">Sub Total</td><td class="px-2 py-2 border border-gray-400 border-b-gray-800 text-right"><strong> </strong></td></tr><tr><td class="px-2 py-2 border border-gray-800">Overall TAX</td><td class="px-2 py-2 border border-gray-800 text-right"><button class="underline"><span><strong> </strong> <!></span></button></td></tr><tr><td class="px-2 py-2 border border-gray-800">Overall Discount</td><td class="px-2 py-2 border border-gray-800 text-right"><button class="underline"><span><strong> </strong> <!></span></button></td></tr><tr><td class="px-2 py-2 border border-gray-800 font-semibold">Total</td><td class="px-2 py-2 border border-gray-800 text-right font-semibold"> </td></tr></tbody></table></div></div> <div><p class="text-red-500"> </p></div></section> <footer class="card-footer flex justify-end"><button class="btn variant-filled">save</button></footer></div></form>');function be(T,o){za(o,!0);const n=Ba();let d=c(o,"name",3,"New Sale"),p=c(o,"title",15,""),y=c(o,"notes",15,""),I=c(o,"client_id",15,0),U=c(o,"client_name",3,""),X=c(o,"total_item_price",15,0),j=c(o,"total_item_tax_amount",15,0),q=c(o,"total_item_discount_amount",15,0),x=c(o,"sub_total",15,0),h=c(o,"overall_discount_amount",15,0),k=c(o,"overall_tax_amount",15,0),z=c(o,"total",15,0),B=c(o,"sales_date",31,()=>M(new Date().toISOString().slice(0,16))),D=c(o,"modeOptions",19,()=>[["invoice","Invoice"],["direct_sale","Direct Sale"]]),u=c(o,"lines",31,()=>M([])),ca=c(o,"contactsNameIndex",19,()=>({})),ft=G(M(D().length>0?D()[0][0]:"")),yt=G(""),E=G(0),F=G(0);Xa(()=>{X(u().reduce((v,r)=>v+r.amount*r.qty,0)),j(u().reduce((v,r)=>v+r.tax_amount*r.qty,0)),q(u().reduce((v,r)=>v+r.discount_amount*r.qty,0)),x(u().reduce((v,r)=>v+r.total_amount,0)),Q(E,k()/x()*100),Q(F,h()/x()*100),z(x()+k()-h())});var H=La(),ht=a(H),J=a(ht),K=a(J),va=a(K);t(K);var kt=e(K,2),pa=a(kt);w(pa,()=>D().length>0,v=>{Ca(v,{children:(r,Yt)=>{var N=qa(),P=la(N);na(P,17,D,da,(A,C)=>{let R=()=>s(C)[0],mt=()=>s(C)[1];Ga(A,{get group(){return s(ft)},set group(S){Q(ft,M(S))},name:"justify",get value(){return R()},children:(S,$t)=>{Aa();var O=g();_(()=>l(O,mt())),m(S,O)},$$slots:{default:!0}})}),m(r,N)},$$slots:{default:!0}})}),t(kt),t(J);var L=e(J,2),V=a(L),W=a(V),Y=a(W),St=e(a(Y),2),wt=a(St);ia(wt),t(St),t(Y);var Tt=e(Y,2),It=e(a(Tt),2),Z=a(It),ma=a(Z);t(Z);var $=e(Z,2);$.__click=[Qa,n,o,p,I];var ua=a($);_a(ua,{name:"plus",className:"w-4 h-4 inline-block align-middle"}),t($),t(It),t(Tt),t(W);var Dt=e(W,2),Nt=e(a(Dt),2);ia(Nt),t(Dt),t(V);var tt=e(V,2),Ot=a(tt),jt=e(a(Ot));na(jt,21,u,da,(v,r,Yt)=>{var N=Ja(),P=a(N),Zt=a(P);t(P);var A=e(P),C=a(A);t(A);var R=e(A),mt=a(R);w(mt,()=>s(r).amount===s(r).price,b=>{var i=g();_(()=>l(i,s(r).amount)),m(b,i)},b=>{var i=Ha(),bt=la(i),Oa=a(bt);t(bt);var sa=e(bt,2),ja=a(sa);t(sa),_(()=>{l(Oa,`${s(r).price??""} - (${s(r).discount_amount??""})`),l(ja,s(r).amount)}),m(b,i)}),t(R);var S=e(R),$t=a(S);w($t,()=>s(r).tax_amount,b=>{var i=g();_(()=>l(i,s(r).tax_amount)),m(b,i)},b=>{var i=g("-");m(b,i)}),t(S);var O=e(S),ut=e(a(O)),ta=a(ut),aa=e(ta);w(aa,()=>s(r).discount_amount,b=>{var i=g();_(()=>l(i,`- ${s(r).discount_amount??""}`)),m(b,i)});var Ia=e(aa,2);w(Ia,()=>s(r).tax_amount,b=>{var i=g();_(()=>l(i,`+ ${s(r).tax_amount??""}`)),m(b,i)}),t(ut);var ea=e(ut),ra=e(ea),Da=a(ra);t(ra),t(O);var oa=e(O),Na=a(oa);Na.__click=()=>{u().splice(Yt,1),u(u())},t(oa),t(N),_(()=>{l(Zt,s(r).info),l(C,s(r).qty),l(ta,`${s(r).price??""} `),l(ea,` ) * ${s(r).qty??""} = `),l(Da,s(r).total_amount)}),m(v,N)}),t(jt),t(Ot),t(tt);var at=e(tt,2),et=a(at);et.__click=[Ua,n,o,u];var ba=a(et);_a(ba,{name:"plus",className:"w-4 h-4 inline-block align-middle"}),t(et),t(at);var rt=e(at,2),ot=a(rt),qt=e(a(ot),2);Ma(qt),t(ot);var zt=e(ot,2),Pt=a(zt),At=a(Pt),st=a(At),Rt=e(a(st)),Mt=a(Rt),xa=a(Mt);_(()=>l(xa,f(j()))),t(Mt),t(Rt),t(st);var lt=e(st),Xt=e(a(lt)),Bt=a(Xt),ga=a(Bt);_(()=>l(ga,f(q()))),t(Bt),t(Xt),t(lt);var nt=e(lt),Ct=e(a(nt)),Gt=a(Ct),fa=a(Gt);_(()=>l(fa,f(x()))),t(Gt),t(Ct),t(nt);var dt=e(nt),Qt=e(a(dt)),it=a(Qt);it.__click=[Ea,n,x,k];var Ut=a(it),_t=a(Ut),ya=a(_t);_(()=>l(ya,f(k()))),t(_t);var ha=e(_t,2);w(ha,()=>s(E),v=>{var r=g();_(()=>l(r,`[${f(s(E))??""}%]`)),m(v,r)}),t(Ut),t(it),t(Qt),t(dt);var ct=e(dt),Et=e(a(ct)),vt=a(Et);vt.__click=[Fa,n,x,h];var Ft=a(vt),pt=a(Ft),ka=a(pt);_(()=>l(ka,f(h()))),t(pt);var Sa=e(pt,2);w(Sa,()=>s(F),v=>{var r=g();_(()=>l(r,`[${f(s(F))??""}%]`)),m(v,r)}),t(Ft),t(vt),t(Et),t(ct);var Ht=e(ct),Jt=e(a(Ht)),wa=a(Jt);_(()=>l(wa,f(z()))),t(Jt),t(Ht),t(At),t(Pt),t(zt),t(rt);var Kt=e(rt,2),Lt=a(Kt),Ta=a(Lt);t(Lt),t(Kt),t(L);var Vt=e(L,2),Wt=a(Vt);Wt.__click=[Ka,o,p,y,I,U,X,j,q,x,h,k,z,B,u,yt],t(Vt),t(ht),t(H),_(()=>{l(va,d()),l(ma,ca()[I()]||""),l(Ta,s(yt)),Wt.disabled=u().length===0||!I()}),xt(wt,p),xt(Nt,B),xt(qt,y),m(T,H),Pa()}Ra(["click"]);export{be as S};
