import{c as k,a as D}from"../chunks/Celh2SBM.js";import{p as I,g as S,i as c,f as h,a as y,h as i,d as o,e as l}from"../chunks/BC9Cf8Q3.js";import{i as C}from"../chunks/BgSg1_cg.js";import{p as d}from"../chunks/CKwprqj2.js";import{s as E,a as L}from"../chunks/BvXhjoeW.js";import{N as O}from"../chunks/Dq_7tmzI.js";import{p as j}from"../chunks/C1rFHlC-.js";import"../chunks/CMsATdMh.js";import"../chunks/C6IzKD7A.js";import{L as z}from"../chunks/JNyEhxU_.js";import{g as A}from"../chunks/BW30Hxfo.js";import{S as B}from"../chunks/NgzE3smS.js";function X(f,g){I(g,!0);const[u,_]=E(),s=L(j,"$page",u).params.pid,r=O(S("__api__"));let p=c(d([])),n=c(!0);(async()=>{i(n,!0);const t=await r.listContacts(s);t.status===200&&(i(p,d(t.data)),i(n,!1))})();let x=l(()=>o(p).reduce((t,a)=>{const e=a.id,N=a.name;return t[e]=N,t},{}));const $=async t=>{console.log("@submit/data",t);const a={estimate:{...t.sale,sales_date:new Date(t.sale.sales_date).toISOString()},lines:t.lines},e=await r.addEstimate(s,a);return e.status!==200?e.data.message:(A(`/z/pages/portal/projects/books/${s}/estimates`),"")};var m=k(),b=h(m);{var v=t=>{z(t,{})},w=t=>{const a=l(()=>Number(s));B(t,{name:"New Estimate",modeOptions:[],get pid(){return o(a)},api:r,get contactsNameIndex(){return o(x)},submit:$})};C(b,t=>{o(n)?t(v):t(w,!1)})}D(f,m),y(),_()}export{X as component};
