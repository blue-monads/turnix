import{a as c,t as f,c as O,b as X}from"../chunks/uYeY98Ep.js";import{p as J,g as P,c as i,d as u,r as s,a as V,h as N,s as _,f as S,i as D,t as j,b as Y}from"../chunks/CRNwc6nF.js";import{d as E,r as Z}from"../chunks/CHLatDmB.js";import{p as U}from"../chunks/Ycl9y-hy.js";import{s as aa,a as ea}from"../chunks/xNd68Pov.js";import"../chunks/DSROIJzG.js";import{A as ta}from"../chunks/g85Fs1Im.js";/* empty css                */import"../chunks/dt-uJVo0.js";import"../chunks/BmWNUg7v.js";import{A as ra}from"../chunks/CqfoOsKq.js";import{p as sa}from"../chunks/bUAA_rse.js";import{N as G}from"../chunks/DjZHZay9.js";import{S as oa}from"../chunks/CTtbmK_c.js";import{i as C}from"../chunks/DPugg-eY.js";import{r as ia,s as la}from"../chunks/Bo8IgBjd.js";import{b as q}from"../chunks/C6nodsJR.js";import{g as B}from"../chunks/lZe3btPj.js";import{s as I}from"../chunks/CdHdDXtF.js";import{e as ca,i as na}from"../chunks/Bbg2O9W9.js";var da=(p,t,o)=>{t({name:u(o)})},pa=f('<header class="card-header"><h4 class="h4">Add Device</h4></header> <section class="p-4 flex flex-col gap-4"><label class="label"><span>Name</span> <input class="input p-1" type="text" placeholder="Name"></label></section> <footer class="card-footer flex justify-end"><button class="btn variant-filled">create</button></footer>',1),va=f('<div class="p-4 flex justify-center"><div class="spinner">loading...</div></div>'),ma=(p,t)=>{navigator.clipboard.writeText(u(t))},fa=(p,t)=>{t.onAddDevice()},_a=f(`<header class="card-header"><h4 class="h4">Device Register token</h4></header> <section class="p-4 flex flex-col gap-4"><label class="label"><span>register URL</span> <textarea class="input p-1 textarea" cols="30" disabled>
                    </textarea> <button class="rounded p-0.5 bg-gray-200">Copy</button></label></section> <footer class="card-footer flex justify-end"><button class="btn variant-filled">close</button></footer>`,1),ua=f('<div class="p-2"><div class="card"><!></div></div>');function ga(p,t){J(t,!0);let o=N(""),v=N(""),g=N("form");const m=G(P("__api__")),b=async n=>{D(g,"loading");const a=await m.addDevice(t.pid,n);if(a.status!==200){console.error("Failed to add device",a);return}const e=a.data;D(v,`${window.location.origin}/z/project/simplerat/${t.pid}/device/finish-setup?token=${e}`),D(g,"result")};var h=ua(),y=i(h),x=i(y);{var A=n=>{var a=pa(),e=_(S(a),2),d=i(e),l=_(i(d),2);ia(l),s(d),s(e);var r=_(e,2),k=i(r);k.__click=[da,b,o],s(r),q(l,()=>u(o),$=>D(o,$)),c(n,a)},w=n=>{var a=O(),e=S(a);{var d=r=>{var k=va();c(r,k)},l=r=>{var k=O(),$=S(k);{var H=F=>{var T=_a(),R=_(S(T),2),K=i(R),z=_(i(K),2);Z(z);var M=_(z,2);M.__click=[ma,v],s(K),s(R);var L=_(R,2),Q=i(L);Q.__click=[fa,t],s(L),q(z,()=>u(v),W=>D(v,W)),c(F,T)};C($,F=>{u(g)==="result"&&F(H)},!0)}c(r,k)};C(e,r=>{u(g)==="loading"?r(d):r(l,!1)},!0)}c(n,a)};C(x,n=>{u(g)==="form"?n(A):n(w,!1)})}s(y),s(h),c(p,h),V()}E(["click"]);var ba=f("<pre> </pre>"),ha=f('<tr><td class="p-2 border"> </td><td class="p-2 border"><!></td></tr>'),ya=f('<div class="max-w-2xl p-2"><table><thead><tr><th class="p-2">Key</th><th class="p-2">Value</th></tr></thead><tbody></tbody></table></div>');function xa(p,t){var o=ya(),v=i(o),g=_(i(v));ca(g,21,()=>Object.entries(t.data),na,(m,b)=>{let h=()=>u(b)[0],y=()=>u(b)[1];var x=ha(),A=i(x),w=i(A,!0);s(A);var n=_(A),a=i(n);{var e=l=>{var r=ba(),k=i(r,!0);s(r),j($=>I(k,$),[()=>JSON.stringify(y(),null,4)]),c(l,r)},d=l=>{var r=X();j(()=>I(r,y())),c(l,r)};C(a,l=>{typeof y()=="object"?l(e):l(d,!1)})}s(n),s(x),j(()=>I(w,h())),c(m,x)}),s(g),s(v),s(o),c(p,o)}var Aa=f('<img alt="Screenshot">');function ka(p,t){var o=Aa();j(()=>la(o,"src",`data:image/png;base64,${t.data??""}`)),c(p,o)}var wa=(p,t,o,v)=>{t.show(ga,{pid:o,onAddDevice:async()=>{t.close(),v()}})},Da=f('<div class="flex flex-wrap justify-end gap-2"><button class="btn variant-filled btn-sm"><!> Device</button></div>'),$a=f('<ol class="breadcrumb"><li class="crumb"><a class="anchor" href="/z/pages/portal/projects/simplerat">SimpleRATS</a></li> <li class="crumb-separator" aria-hidden="">&rsaquo;</li> <li>Devices</li></ol>'),Sa=f("<!> <!>",1);function Ma(p,t){J(t,!0);const[o,v]=aa(),m=ea(sa,"$page",o).params.pid,b=G(P("__api__")),h=P("__vs_modal__");let y=N(U([]));const x=async()=>{const a=await b.listDevices(m);a.status===200&&D(y,U(a.data))};x();var A=Sa(),w=S(A);ra(w,{children:(a,e)=>{var d=Da(),l=i(d);l.__click=[wa,h,m,x];var r=i(l);oa(r,{className:"h-4 w-4",name:"plus"}),Y(),s(l),s(d),c(a,d)},$$slots:{default:!0,lead:(a,e)=>{var d=$a();c(a,d)}}});var n=_(w,2);ta(n,{action_key:"id",key_names:[["id","ID"],["name","Name"],["created_at","Created At"],["status","Status"]],get datas(){return u(y)},hashSeed:99,color:["status"],show_drop:!0,actions:[{Name:"Ping",Class:"variant-filled-primary",icon:"paper-airplane",Action:async a=>{const e=await b.performDeviceAction(m,a,"ping",{});if(e.status!==200){console.error("Failed to ping device",e);return}console.log("Pinged device",e.data)}},{Name:"Shell",Class:"variant-filled-secondary",icon:"command-line",Action:async a=>{B(`/z/pages/portal/projects/simplerat/${m}/device/${a}/shell`)}},{Name:"FS",Class:"variant-filled-tertiary",icon:"folder",Action:async a=>{B(`/z/pages/portal/projects/simplerat/${m}/device/${a}/fs`)}},{Name:"Info",drop:!0,Action:async a=>{const e=await b.performDeviceAction(m,a,"system.info",{});if(e.status!==200){console.error("Failed to kill device",e);return}h.show(xa,{data:e.data})}},{Name:"Screenshot",drop:!0,Action:async a=>{const e=await b.performDeviceAction(m,a,"system.screenshot",{});if(e.status!==200){console.error("Failed to kill device",e);return}h.show(ka,{data:e.data}),console.log("Killed device",e.data)}}]}),c(p,A),V(),v()}E(["click"]);export{Ma as component};
