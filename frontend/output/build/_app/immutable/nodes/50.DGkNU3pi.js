import{c as x,a as N}from"../chunks/disclose-version.BOfWGsg9.js";import{p as k,g as v,i as c,f as D,a as I,h as i,b as o,d}from"../chunks/runtime.CmPLUjJJ.js";import{i as S}from"../chunks/if.DoU_1wcm.js";import{p as l}from"../chunks/proxy.DKs42Gzo.js";import{s as h,a as y}from"../chunks/store.BN9B0iWR.js";import{N as C}from"../chunks/index.Dq_7tmzI.js";import{p as E}from"../chunks/stores.DkdCKZTz.js";import"../chunks/index.DnNofn7z.js";import"../chunks/autotable.D5y0wA8l.js";import{L}from"../chunks/loader._7BlSOYJ.js";import{g as O}from"../chunks/entry.CyBKS7ox.js";import{S as j}from"../chunks/SaleMaker.BNykfGoz.js";function U(f,g){k(g,!0);const u=h(),s=y(E,"$page",u).params.pid,r=C(v("__api__"));let p=c(l([])),n=c(!0);(async()=>{i(n,!0);const t=await r.listContacts(s);t.status===200&&(i(p,l(t.data)),i(n,!1))})();let _=d(()=>o(p).reduce((t,a)=>{const e=a.id,w=a.name;return t[e]=w,t},{}));const b=async t=>{console.log("@submit/data",t);const a={estimate:{...t.sale,sales_date:new Date(t.sale.sales_date).toISOString()},lines:t.lines},e=await r.addEstimate(s,a);return e.status!==200?e.data.message:(O(`/z/pages/portal/projects/books/${s}/estimates`),"")};var m=x(),$=D(m);S($,()=>o(n),t=>{L(t,{})},t=>{var a=d(()=>Number(s));j(t,{name:"New Estimate",modeOptions:[],get pid(){return o(a)},api:r,get contactsNameIndex(){return o(_)},submit:b})}),N(f,m),I()}export{U as component};
